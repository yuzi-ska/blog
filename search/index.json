[{"content":"起因 原因是发现群晖明明还有很多的内存也会就经常进行swap交换，导致硬盘一直非常的吵（尤其是多盘位的机型）而且频繁读写也可能导致硬盘寿命下降，因此找的解决方法。\n解决方案 小内存优化 先在任务计划内创建一个触发的任务，使用root权限执行，事件执行为开机执行，定义的脚本填写\n1 sysctl -w vm.swappiness=1 对于内存在8G的可以在任意一个文件夹内创建一个任意名称.sh的脚本，内容填写\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 #!/bin/bash # 脚本名称: manage_zram.sh # 描述: 这个脚本用于在群晖NAS上管理zram设备，包括创建、配置和停用zram。 # 使用方法: sudo ./manage_zram.sh [-p \u0026lt;百分比\u0026gt;] [-d] [-m \u0026lt;最大压缩流\u0026gt;] # 选项: # -p, --percent: 设置zram大小占总内存的百分比（默认50%） # -d, --disable: 停用zram设备 # -m, --max-streams: 设置最大压缩流数量（默认为CPU核心数） set -e # 遇到错误立即退出 set -u # 使用未定义的变量时报错 # 默认值 RAM_PERCENT=50 DISABLE_ZRAM=false MAX_COMP_STREAMS=$(nproc) # 错误处理函数 error_exit() { echo \u0026#34;错误: $1\u0026#34; \u0026gt;\u0026amp;2 exit 1 } # 日志函数 log() { echo \u0026#34;$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - $1\u0026#34; } # 解析命令行参数 while [[ $# -gt 0 ]]; do case $1 in -p|--percent) RAM_PERCENT=\u0026#34;$2\u0026#34; if ! [[ $RAM_PERCENT =~ ^[0-9]+$ ]] || [ $RAM_PERCENT -lt 1 ] || [ $RAM_PERCENT -gt 100 ]; then error_exit \u0026#34;RAM百分比必须是1到100之间的整数。\u0026#34; fi shift 2 ;; -d|--disable) DISABLE_ZRAM=true shift ;; -m|--max-streams) MAX_COMP_STREAMS=\u0026#34;$2\u0026#34; if ! [[ $MAX_COMP_STREAMS =~ ^[0-9]+$ ]] || [ $MAX_COMP_STREAMS -lt 1 ]; then error_exit \u0026#34;最大压缩流数量必须是正整数。\u0026#34; fi shift 2 ;; *) error_exit \u0026#34;未知选项: $1\\n使用方法: $0 [-p \u0026lt;百分比\u0026gt;] [-d] [-m \u0026lt;最大压缩流\u0026gt;]\u0026#34; ;; esac done # 检查root权限 [[ $EUID -ne 0 ]] \u0026amp;\u0026amp; error_exit \u0026#34;此脚本必须以root权限运行。\u0026#34; # 检查是否为DSM系统 [[ ! -f \u0026#34;/etc.defaults/VERSION\u0026#34; ]] \u0026amp;\u0026amp; error_exit \u0026#34;无法检测到DSM系统，脚本可能无法正常工作。\u0026#34; # 检查zram模块是否可用 check_zram_available() { if ! modprobe -n zram \u0026amp;\u0026gt;/dev/null; then error_exit \u0026#34;zram模块不可用。请确保您的系统支持zram。\u0026#34; fi } # 停用zram函数 disable_zram() { local zram_devs=$(ls /dev/zram* 2\u0026gt;/dev/null) if [[ -n \u0026#34;$zram_devs\u0026#34; ]]; then for dev in $zram_devs; do swapoff $dev 2\u0026gt;/dev/null || log \u0026#34;无法停用 $dev\u0026#34; echo 1 \u0026gt; /sys/block/$(basename $dev)/reset 2\u0026gt;/dev/null || log \u0026#34;无法重置 $dev\u0026#34; done rmmod zram 2\u0026gt;/dev/null || log \u0026#34;无法卸载zram模块\u0026#34; log \u0026#34;zram已停用并移除。\u0026#34; else log \u0026#34;未检测到活动的zram设备。\u0026#34; fi } # 配置和启用zram configure_zram() { # 加载zram模块 modprobe zram num_devices=1 || error_exit \u0026#34;无法加载zram模块。\u0026#34; # 设置最大压缩流 echo $MAX_COMP_STREAMS \u0026gt; /sys/block/zram0/max_comp_streams || log \u0026#34;无法设置最大压缩流，使用默认值。\u0026#34; # 计算zram大小 local TOTAL_MEM=$(grep MemTotal /proc/meminfo | awk \u0026#39;{print $2}\u0026#39;) local ZRAM_SIZE=$((TOTAL_MEM * 1024 * RAM_PERCENT / 100)) # 设置zram大小 echo $ZRAM_SIZE \u0026gt; /sys/block/zram0/disksize || error_exit \u0026#34;无法设置zram大小。\u0026#34; # 创建swap并启用 mkswap /dev/zram0 || error_exit \u0026#34;无法创建swap分区。\u0026#34; swapon -p 100 /dev/zram0 || error_exit \u0026#34;无法启用zram swap。\u0026#34; log \u0026#34;zram已成功配置并启用为swap\u0026#34; log \u0026#34;压缩算法: lzo (群晖NAS默认)\u0026#34; log \u0026#34;最大压缩流: $(cat /sys/block/zram0/max_comp_streams)\u0026#34; log \u0026#34;RAM使用百分比: $RAM_PERCENT%\u0026#34; log \u0026#34;zram大小: $((ZRAM_SIZE / 1024 / 1024)) MB\u0026#34; } # 主逻辑 check_zram_available if [[ $DISABLE_ZRAM = true ]]; then disable_zram else disable_zram # 先停用现有的zram设备 configure_zram fi 然后在任务计划内新增一个触发的计划任务（注：需要root权限执行），先行任务填关闭swap的任务即可，用户定义的脚本填写刚刚写好的脚本路径，如：volume1/plan/创建的脚本名.sh。\nsh脚本来自sleele大佬。\n大内存优化 对于内存大于8G以上的建议直接关闭swap，执行第一条即可，有条件的话可以添加SSD读写缓存，实测对于小文件频繁读写多的场景提升挺大的，噪音也小了很多，需要注意的是群晖默认会从第一块盘启动系统，如果有添加SSD缓存可以把固态硬盘放在第一位。\n","date":"2025-03-28T00:00:00Z","image":"https://image-yuzi.oss-cn-shanghai.aliyuncs.com/img/1740150509560.jpg","permalink":"https://yuzia.fun/p/dis-swap/","title":"群晖优化虚拟内存以及关闭swap"},{"content":"解决方案 直接给出解决方案，在emby网络内将安全连接模式改成由反向代理处理即可。\n（水一期（￣︶￣）↗　）\n","date":"2025-03-10T00:00:00Z","image":"https://image-yuzi.oss-cn-shanghai.aliyuncs.com/img/1740150509508.jpg","permalink":"https://yuzia.fun/p/emby-agency/","title":"emby部分反向代理加载缓慢解决方案"},{"content":"准备工作 需要有一个能够24小时开机的主机，比如在Nas或者Server上创建。\n创建虚拟机 以我使用的群晖举例，首先在虚拟机的映像中选择硬盘映像，其他虚拟机大部分同理。\n导入一个软路由的镜像，这里以openwrt高大全版本举例。\n再回到虚拟机界面选择导入。\n从硬盘映像导入。\n规格默认即可。\n在存储空间里选择刚刚导入的硬盘镜像。\n在网卡界面选择e1000（兼容性更好些）。\n其余设置默认即可，自动启动按需选择即可。\n然后勾选创建完后打开虚拟机\n然后回到虚拟机界面点击连接\n配置软路由 命令行配置 来到以下界面后，按任意键位（只要不是系统键位都行）。\n进入到以下界面\n选择1，然后输入你的内网任意未被使用的IP地址，如果不确定，可以打开自己电脑的命令行窗口输入ipconfig\n通常前三位就是局域网固定IP。\n输入完后回车，再输入4然后会确认是否需要重启，填入y重启。\n网页配置 在浏览器中输入刚才选择的IP地址，进入页面\n默认无密码，进去后请先根据提示更改密码。\n更改密码后来到网络接口页面\n填写网关以及关闭IPV6和DHCP\n然后记得保存并应用接口配置就算完成了。\n魔法配置 能够使用的有很多种，以我常用的小猫咪举例。\n进入后可以先不下载内核。\n先进行以下更改\n来到流量控制界面\n来到覆写设置界面，需要把开发者选项中27行这串代码注释去掉，随后把下方自定义上游DNS服务全部取消勾选。\n覆写设置的DNS设置\n配置文件设置 建议先用自带电脑把clash的配置拉取过来后新建一个config.yaml文件，然后把配置信息填入进去保存后再上传（原因是因为软路由这里订阅拉取经常拉取不到，如果能够拉取可以直接填写订阅地址即可）\n更新内核 如果直接在界面下载无法更新内核，这时候需要用到ssh来进行上传文件\n连接ssh，如果使用高大全版本则输入9退出菜单,其他版本则忽略。\ntun模式内核默认在/etc/openclash/core/clash_tun\n可以使用ftp工具将文件上传至这个目录，随后重新在插件见面启动即可。\n使用指南 在网络节目修改以下信息即可\n所有端同理，还有进阶玩法可以不用一个个修改，不过如果软路由损坏会导致家庭网络崩溃，无特殊需求可以不部署（后续也许会出一期qwq）\n疑难杂症 创建软路由的本体是否能够填写来进行魔法上网？\n答：虽然网络上有说不可以，但以我自己实测是可以使用的\n工具链接 TUN模式内核 | TUN模式游戏内核\nOpenwrt镜像：\n百度网盘 提取码: 51jm Alist（目前仅支持IPV6） ","date":"2025-02-02T00:00:00Z","image":"https://image-yuzi.oss-cn-shanghai.aliyuncs.com/img/1740150398299.jpeg","permalink":"https://yuzia.fun/p/virtual-pc-deploy-router/","title":"使用虚拟机创建软（旁）路由实现魔法上网"},{"content":"入口与注册 点击此处xAI进入注册入口\n可以使用QQ邮箱进行注册，如果有X账号或者谷歌账号直接登入即可。\n如果选择注册，那么会跳出邮箱认证界面。\n在注册的邮箱内认证即可。\n勾选隐私协议与年龄政策\nAPI获取 选择创建API key\n创建后建议创建一个文本文档复制过去(请注意，该API只显示一次且建议不分享给任何人，如果分享给其他人，别人将可以使用你的API额度)\n如果API泄漏或者忘记，可以前往左侧菜单栏第二位创建新的API\n填写API名字后默认下一步即可。\n回到主页后可以查看额度使用情况。\n一些问题 此网站需要科学上网使用，默认可能无法打开\n具体调用 可以使用任意一个支持自定义API功能的chat软件，这里不过多推荐。\n","date":"2024-11-22T00:00:00Z","image":"https://image-yuzi.oss-cn-shanghai.aliyuncs.com/img/20230715225556.png","permalink":"https://yuzia.fun/p/xai-sign/","title":"xAI注册与使用"},{"content":"下载Ollama 点击此处下载Ollama，选择对应的系统版本下载即可。\n随后来到安装界面，点击install，无需进行其他操作，等待完成即可。\n调取Ollama 由于Ollama没有图形界面，所以需要使用命令行工具调取。\n输入\n1 Ollama 查看Ollama是否能被正常调用，如下图\n显示以下结果即为正常。\n下载模型 如果Ollama正常，前往Ollama官网模型地址下载需要的模型。\n在Ollama模型地址打开任意一个模型，如下图演示的Ollama3.2模型。\n点击此处代码块右边的复制按键。\n复制完成后打开命令行，将复制后的代码粘贴进去。\n按下回车后即可开始下载。\n查看下载的模型文件与调用 可以通过输入\n1 Ollama list 查看下载的模型文件。如需调用，输入“\n1 Ollama run 任意模型名字 看到这样的提示则代表调用正常，就可以愉快的与大模型对话了，如果需要退出，可以直接关闭命令行，Ollama在一定时间后会自动释放显存，也可以输入“/bye”指令退出。\n常见问题以及解决方案 time out报错 如果在中途中出现time out报错，是因为国内拉取不稳定，多复制几次下载即可。\n","date":"2024-11-18T00:00:00Z","image":"https://image-yuzi.oss-cn-shanghai.aliyuncs.com/img/20230717095021.png","permalink":"https://yuzia.fun/p/ollama/","title":"使用Ollama部署Ai模型"}]